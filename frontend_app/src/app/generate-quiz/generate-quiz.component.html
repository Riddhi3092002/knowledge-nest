<mat-card class="quiz-card">
  <h2>Generate Quiz</h2>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Select skills</mat-label>
    <mat-select [(value)]="selectedSkills" multiple>
      <mat-option *ngFor="let skill of availableSkills" [value]="skill">{{
        skill
      }}</mat-option>
    </mat-select>
  </mat-form-field>

  <div class="quiz-actions">
    <button
      mat-raised-button
      color="primary"
      (click)="generateQuiz()"
      [disabled]="loading || selectedSkills.length === 0"
    >
      Generate Quiz
    </button>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <mat-progress-spinner
      mode="indeterminate"
      color="primary"
    ></mat-progress-spinner>
  </div>

  <div *ngIf="quiz?.questions?.length">
    <form>
      <div
        *ngFor="let q of quiz.questions; let i = index"
        class="question-block"
      >
        <div class="question-header">
          <span class="question-number">{{ i + 1 }}.</span>
          <h4 class="question-text">{{ q.question }}</h4>
        </div>
        <mat-radio-group
          [(ngModel)]="userAnswers[i]"
          name="q{{ i }}"
          class="options-group"
        >
          <mat-radio-button
            *ngFor="let opt of q.options"
            [value]="opt[0]"
            class="option-radio"
          >
            {{ opt }}
          </mat-radio-button>
        </mat-radio-group>

        <div
          *ngIf="results.length > 0"
          [ngClass]="{
            correct: results[i].correct,
            incorrect: !results[i].correct
          }"
          class="answer-feedback"
        >
          <mat-icon *ngIf="results[i].correct" color="primary"
            >check_circle</mat-icon
          >
          <mat-icon *ngIf="!results[i].correct" color="warn">cancel</mat-icon>
          <small>
            Correct Answer:
            <span class="correct-answer">{{ results[i].correctAnswer }}</span>
          </small>
        </div>
        <hr class="question-divider" />
      </div>

      <div class="quiz-actions">
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="submitQuiz()"
        >
          Submit Answers
        </button>
      </div>
    </form>

    <div *ngIf="results.length > 0" class="score-section">
      <mat-card class="score-card">
        <mat-icon color="primary" class="score-icon">emoji_events</mat-icon>
        <span class="score-label">Your Score:</span>
        <span class="score-value">{{ score }}</span>
        <span class="score-total">/ {{ quiz.questions.length }}</span>
      </mat-card>
    </div>
  </div>
</mat-card>
